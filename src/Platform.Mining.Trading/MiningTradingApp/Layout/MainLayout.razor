@using Microsoft.AspNetCore.Components
@using Radzen
@using Radzen.Blazor
@* @attribute [Authorize] *@
@inherits LayoutComponentBase

@* PSEUDOCODE:
- Inject NavigationManager as NavManager.
- Replace all RadzenPanelMenuItem Path attributes from literal routes (e.g., "/settings")
  to NavManager.WithBase("<route>") to respect app base path.
- Use single quotes around attribute values to avoid Razor quote conflicts.
- Leave other component structure unchanged.
*@

<RadzenDialog />
<RadzenLayout>
    <RadzenHeader>
        <ChildContent>
            <RadzenRow AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Start" Gap="0px">
                <RadzenColumn Size="5">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                        <RadzenSidebarToggle Click="@(args => { sidebarExpanded = !sidebarExpanded; bodyExpanded = !bodyExpanded; })">
                        </RadzenSidebarToggle>
                        <RadzenLabel Text="Minerals Trading Platform" style="overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                        </RadzenLabel>
                    </RadzenStack>
                </RadzenColumn>
                <RadzenColumn Size="7">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.End">
                        <LoginDisplay />
                    </RadzenStack>
                </RadzenColumn>
            </RadzenRow>
        </ChildContent>
    </RadzenHeader>
    <RadzenBody @ref="@body0" @bind-Expanded="@bodyExpanded">
        <ChildContent>
            <RadzenContentContainer Name="main">
                @Body
            </RadzenContentContainer>
        </ChildContent>
    </RadzenBody>
    <RadzenSidebar @ref="@sidebar0" @bind-Expanded="@sidebarExpanded" Class="demos-sidebar" style="display: flex; flex-direction: column">
        <div style="padding: 1rem">
            <RadzenTextBox Placeholder="Find page ..." type="search" @oninput="@FilterPanelMenu" style="width: 100%" Class="rz-search-input" />
        </div>
        <RadzenPanelMenu Style="height: 100%;">
            <RadzenPanelMenuItem Text="Dashboard" Icon="dashboard" Expanded="true">
                <RadzenPanelMenuItem Text="Trading Dashboard" Path='@NavManager.WithBase("trading-dashboard")' />
                <RadzenPanelMenuItem Text="System Monitoring" Path='@NavManager.WithBase("monitoring")' />
            </RadzenPanelMenuItem>

            <RadzenPanelMenuItem Text="Trading" Icon="trending_up" Expanded="true">
                <RadzenPanelMenuItem Text="Trade Management" Path='@NavManager.WithBase("trades")' />
                <RadzenPanelMenuItem Text="Buyer Management" Path='@NavManager.WithBase("buyers")' />
                <RadzenPanelMenuItem Text="Seller Management" Path='@NavManager.WithBase("sellers")' />
            </RadzenPanelMenuItem>

            <RadzenPanelMenuItem Text="Risk & Margin" Icon="account_balance" Expanded="true">
                <RadzenPanelMenuItem Text="Margin Management" Path='@NavManager.WithBase("margins")' />
            </RadzenPanelMenuItem>

            <RadzenPanelMenuItem Text="Operations" Icon="business" Expanded="true">
                <RadzenPanelMenuItem Text="Warehouse Management" Path='@NavManager.WithBase("warehouses")' />
                <RadzenPanelMenuItem Text="Warrant Management" Path='@NavManager.WithBase("warrants")' />
                <RadzenPanelMenuItem Text="Settlement Management" Path='@NavManager.WithBase("settlements")' />
                <RadzenPanelMenuItem Text="Inspection Management" Path='@NavManager.WithBase("inspections")' />
            </RadzenPanelMenuItem>
        </RadzenPanelMenu>
    </RadzenSidebar>
</RadzenLayout>

@code {
    [Inject] NavigationManager NavManager { get; set; } = default!;

    RadzenSidebar sidebar0;
    RadzenBody body0;
    bool sidebar2Expanded = true;
    bool sidebarExpanded = true;
    bool bodyExpanded = false;
    bool rendered;

    void FilterPanelMenu(ChangeEventArgs args)
    {
        var term = args.Value?.ToString();

        // Func<string, bool> contains = value => value.Contains(term, StringComparison.OrdinalIgnoreCase);
    }
}