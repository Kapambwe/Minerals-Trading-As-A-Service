@using Microsoft.AspNetCore.Components
@using Radzen
@using Radzen.Blazor
@* @attribute [Authorize] *@
@inherits LayoutComponentBase

@* PSEUDOCODE:
- Inject NavigationManager as NavManager.
- Replace all RadzenPanelMenuItem Path attributes from literal routes (e.g., "/settings")
  to NavManager.WithBase("<route>") to respect app base path.
- Use single quotes around attribute values to avoid Razor quote conflicts.
- Leave other component structure unchanged.
*@

<RadzenDialog />
<RadzenLayout>
    <RadzenHeader>
        <ChildContent>
            <RadzenRow AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Start" Gap="0px">
                <RadzenColumn Size="5">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                        <RadzenSidebarToggle Click="@(args => { sidebarExpanded = !sidebarExpanded; bodyExpanded = !bodyExpanded; })">
                        </RadzenSidebarToggle>
                        <RadzenLabel Text="Minerals Trading Platform" style="overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                        </RadzenLabel>
                    </RadzenStack>
                </RadzenColumn>
                <RadzenColumn Size="7">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.End">
                        <LoginDisplay />
                    </RadzenStack>
                </RadzenColumn>
            </RadzenRow>
        </ChildContent>
    </RadzenHeader>
    <RadzenBody @ref="@body0" @bind-Expanded="@bodyExpanded">
        <ChildContent>
            <RadzenContentContainer Name="main">
                @Body
            </RadzenContentContainer>
        </ChildContent>
    </RadzenBody>
    <RadzenSidebar @ref="@sidebar0" @bind-Expanded="@sidebarExpanded" Class="demos-sidebar" style="display: flex; flex-direction: column">
        <div style="padding: 1rem">
            <RadzenTextBox Placeholder="Find page ..." type="search" @oninput="@FilterPanelMenu" style="width: 100%" Class="rz-search-input" />
        </div>
        <RadzenPanelMenu Style="height: 100%;">
            <RadzenPanelMenuItem Text="Dashboard" Icon="dashboard" Expanded="true">
                <RadzenPanelMenuItem Text="Trading Dashboard" Path='@NavManager.WithBase("trading-dashboard")' />
                <RadzenPanelMenuItem Text="System Monitoring" Path='@NavManager.WithBase("system-monitoring")' />
            </RadzenPanelMenuItem>

            <RadzenPanelMenuItem Text="Trading" Icon="trending_up" Expanded="true">
                <RadzenPanelMenuItem Text="Order Entry" Path='@NavManager.WithBase("order-entry")' />
                <RadzenPanelMenuItem Text="Order Book" Path='@NavManager.WithBase("order-book")' />
                <RadzenPanelMenuItem Text="Market Data" Path='@NavManager.WithBase("market-data")' />
                <RadzenPanelMenuItem Text="Trade Blotter" Path='@NavManager.WithBase("trade-blotter")' />
                <RadzenPanelMenuItem Text="Positions & Portfolio" Path='@NavManager.WithBase("positions-portfolio")' />
            </RadzenPanelMenuItem>

            <RadzenPanelMenuItem Text="Risk & Margin" Icon="account_balance" Expanded="true">
                <RadzenPanelMenuItem Text="Margin & Collateral" Path='@NavManager.WithBase("margin-collateral")' />
                <RadzenPanelMenuItem Text="Surveillance" Path='@NavManager.WithBase("surveillance")' />
            </RadzenPanelMenuItem>

            <RadzenPanelMenuItem Text="Operations" Icon="business" Expanded="true">
                <RadzenPanelMenuItem Text="Warehouse Operations" Path='@NavManager.WithBase("warehouse-operations")' />
                <RadzenPanelMenuItem Text="Clearing & Settlement" Path='@NavManager.WithBase("clearing-settlement")' />
                <RadzenPanelMenuItem Text="Settlement Engine" Path='@NavManager.WithBase("settlement-engine")' />
                <RadzenPanelMenuItem Text="Reconciliation" Path='@NavManager.WithBase("reconciliation")' />
            </RadzenPanelMenuItem>

            <RadzenPanelMenuItem Text="Market Administration" Icon="admin_panel_settings" Expanded="true">
                <RadzenPanelMenuItem Text="Market Operations" Path='@NavManager.WithBase("market-operations")' />
                <RadzenPanelMenuItem Text="Matching Engine Admin" Path='@NavManager.WithBase("matching-engine-admin")' />
                <RadzenPanelMenuItem Text="Product Definition" Path='@NavManager.WithBase("product-definition")' />
                <RadzenPanelMenuItem Text="Simulation Lab" Path='@NavManager.WithBase("simulation-lab")' />
            </RadzenPanelMenuItem>

            <RadzenPanelMenuItem Text="Compliance & Users" Icon="security" Expanded="true">
                <RadzenPanelMenuItem Text="KYC & Compliance" Path='@NavManager.WithBase("kyc-compliance")' />
                <RadzenPanelMenuItem Text="User Management" Path='@NavManager.WithBase("user-management")' />
                <RadzenPanelMenuItem Text="Audit Logs" Path='@NavManager.WithBase("audit-logs")' />
            </RadzenPanelMenuItem>
        </RadzenPanelMenu>
    </RadzenSidebar>
</RadzenLayout>

@code {
    [Inject] NavigationManager NavManager { get; set; } = default!;

    RadzenSidebar sidebar0;
    RadzenBody body0;
    bool sidebar2Expanded = true;
    bool sidebarExpanded = true;
    bool bodyExpanded = false;
    bool rendered;

    void FilterPanelMenu(ChangeEventArgs args)
    {
        var term = args.Value?.ToString();

        // Func<string, bool> contains = value => value.Contains(term, StringComparison.OrdinalIgnoreCase);
    }
}